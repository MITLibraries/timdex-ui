<%= content_for(:title, results_page_title(@enhanced_query)) %>

<% content_for :additional_meta_tag do %>
  <meta name="robots" content="noindex, nofollow" />
<% end %>

<div class="space-wrap">

  <%= render partial: "shared/site_title" %>

  <%= render partial: "form" %>
  <%= render partial: "search_summary" %>

  <% if ENV.fetch('FACT_PANELS_ENABLED', false).present? %>
    <div id="hint" aria-live="polite">
      <%= render(partial: 'search/issn') if fact_enabled?('issn') %>
      <%= render(partial: 'search/isbn') if fact_enabled?('isbn') %>
      <%= render(partial: 'search/pmid') if fact_enabled?('pmid') %>
      <%= render(partial: 'search/doi') if fact_enabled?('doi') %>
    </div>
  <% end %>

  <%= render(partial: 'shared/error', collection: @errors) %>

  <!-- Tab Navigation -->
  <div class="tab-navigation top-space">
    <%= link_to "Primo", results_path(params.permit(:q, :per_page, :page).merge(tab: 'primo')), 
                class: "tab-link #{'active' if @active_tab == 'primo'}", 
                data: { turbo_frame: "search-results" } %>
    <%= link_to "TIMDEX", results_path(params.permit(:q, :per_page, :page).merge(tab: 'timdex')), 
                class: "tab-link #{'active' if @active_tab == 'timdex'}", 
                data: { turbo_frame: "search-results" } %>
  </div>

  <%= turbo_frame_tag "search-results" do %>
    <div class="layout-3q1q layout-band top-space">
      <main id="results" class="col3q wrap-results">
        <% if @results.present? && @errors.blank? %>
          <h2 class="hd-3 results-context"><%= results_summary(@pagination[:hits]) %> returned</h2>
          <ol class="results-list" start="<%= @pagination[:start] %>">
            <% case @active_tab %>
            <% when 'primo' %>
              <%= render(partial: 'search/result_primo', collection: @results, as: :result) %>
            <% when 'timdex' %>
              <%= render(partial: 'search/result', collection: @results, as: :result) %>
            <% end %>
          </ol>
        <% elsif @errors.blank? %>
          <div class="no-results">
            <p class="hd-2">No results found for your search</p>
          </div>
        <% end %>
      </main>
    </div>
  <% end %>

  <%= render partial: 'shared/ask', locals: { display: 'aside' } if @results.blank? %>

  <% if @results.present? %>
    <div id="pagination">  
      <%= render partial: "pagination" %>
    </div>
    <%= render partial: 'shared/ask', locals: { display: 'view-md' } %>
  <% end %>
</div>

<%= render(partial: 'trigger_tacos') if tacos_enabled? %>

<%= javascript_include_tag "filters" %>
