<li class="result">
  <div class="result-content">
    <h3 class="record-title">
      <span class="sr">Title: </span><%= link_to(result_geo['title'], record_path(result_geo['timdexRecordId'])) %>
    </h3>

    <div class="data-info">
      <%= render partial: 'shared/geo_data_info', locals: { metadata: result_geo } %>
    </div>

    <% if result_geo['contributors'] %> 
      <span class="sr">Contributors: </span>
      <ul class="list-inline truncate-list contributors">
        <%= render partial: 'shared/contributors', locals: { contributors: result_geo['contributors'] } %>
      </ul>
    <% end %>

    <% if result_geo['summary'] %>
      <p class="result-summary truncate-list">
        <span class="sr">Summary: </span><%= result_geo['summary'].join(' ') %>
      </p>
    <% end %>


    <!-- We only care about geospatial locations for this, as place names are also subjects. -->
    <% if geospatial_coordinates?(result_geo['locations']) %>
      <% content_for :additional_meta_tag do %>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>

      <!-- Make sure you put this AFTER Leaflet's CSS -->
          <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
              integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
              crossorigin=""></script>
      <% end %>
      <div id=<%= "map_#{result_geo_counter}" %> style="height: 180px"></div>

      <script>
        var <%= "map_#{result_geo_counter}" %> = L.map('<%= "map_#{result_geo_counter}" %>');
        
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(<%= "map_#{result_geo_counter}" %>);

        // define rectangle geographical bounds
        // -71.158693, -71.064796, 42.395972, 42.351993
        // var bounds = [[42.395972, -71.158693],[42.351993, -71.064796]];

        console.log('#<%= bounding_box_to_coords(result_geo) %>');
        var bounds = <%= bounding_box_to_coords(result_geo) %>;

        // create an orange rectangle
        L.rectangle(bounds, {color: "#ff7800", weight: 1}).addTo(<%= "map_#{result_geo_counter}" %>);

        // zoom the map to the rectangle bounds
        <%= "map_#{result_geo_counter}" %>.fitBounds(bounds);
      </script>

      <p>
        <ul>
          <% parse_nested_field(result_geo['locations']).each do |location| %>
            <% if location['geoshape'].present? %>
              <li><%= "#{location['kind']}: #{location['geoshape']}" %></li>
            <% end %>
          <% end %>
        </ul>
      </p>
    <% else %>
      Hallo
    <% end %>

    <% if result_geo['highlight'] %>
      <div class="result-highlights">
        <%= render partial: 'search/highlights', locals: { result: result_geo } %>
      </div>
    <% end %>

    <div class="result-record">
      <%= view_record(result_geo['timdexRecordId']) %>
    </div>
  </div>
</li>
